services:
  openclaw:
    image: marvintong/openclaw-cvm@sha256:5844d3006ed86d3dd0c10df4b66988ee072deb8b498d0d4779134216bd4bf5ca
    # For local builds, uncomment below and comment out image:
    # build:
    #   context: ..
    #   dockerfile: phala-deploy/Dockerfile
    container_name: openclaw
    privileged: true
    ports:
      - "1022:22"
      - "18789:18789"
    volumes:
      - /home/root/.ssh:/root/.ssh:ro
      - openclaw_data:/data
      - docker_data:/var/lib/docker
    environment:
      NODE_ENV: production
      # Master key — derives rclone crypt passwords + gateway auth token via HKDF
      MASTER_KEY: ${MASTER_KEY:-}
      # AI Providers
      REDPILL_API_KEY: ${REDPILL_API_KEY:-}
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY:-}
      # Chat Channels
      TELEGRAM_BOT_TOKEN: ${TELEGRAM_BOT_TOKEN:-}
      DISCORD_BOT_TOKEN: ${DISCORD_BOT_TOKEN:-}
      SLACK_BOT_TOKEN: ${SLACK_BOT_TOKEN:-}
      SLACK_APP_TOKEN: ${SLACK_APP_TOKEN:-}
      # Encrypted S3 storage (optional — omit S3_BUCKET to use local volume)
      S3_BUCKET: ${S3_BUCKET:-}
      S3_PREFIX: ${S3_PREFIX:-openclaw-data}
      S3_ENDPOINT: ${S3_ENDPOINT:-}
      S3_REGION: ${S3_REGION:-us-east-1}
      S3_PROVIDER: ${S3_PROVIDER:-Other}
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID:-}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY:-}
      # Override derived crypt passwords (optional — only if not using MASTER_KEY)
      RCLONE_CRYPT_PASSWORD: ${RCLONE_CRYPT_PASSWORD:-}
      RCLONE_CRYPT_PASSWORD2: ${RCLONE_CRYPT_PASSWORD2:-}
      # Debug logging (set to 1 to enable)
      OPENCLAW_RAW_STREAM: ${OPENCLAW_RAW_STREAM:-}
      OPENCLAW_ANTHROPIC_PAYLOAD_LOG: ${OPENCLAW_ANTHROPIC_PAYLOAD_LOG:-}
    restart: unless-stopped

volumes:
  openclaw_data:
  docker_data:
