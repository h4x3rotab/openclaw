services:
  openclaw:
    image: h4x3rotab/openclaw-cvm@sha256:db00d280ab1e5d86e8d6ed83f4c94711f53a1f1bfce8a026f1adce661b88d0df
    # For local builds, uncomment below and comment out image:
    # build:
    #   context: ..
    #   dockerfile: phala-deploy/Dockerfile
    container_name: openclaw
    privileged: true
    ports:
      - "1022:22"
      - "18789:18789"
    volumes:
      - /home/root/.ssh:/root/.ssh:ro
      - openclaw_state:/data/openclaw
      - docker_data:/var/lib/docker
    environment:
      OPENCLAW_STATE_DIR: /data/openclaw
      NODE_ENV: production
      # Master key — derives rclone crypt passwords + gateway auth token via HKDF
      MASTER_KEY: ${MASTER_KEY:-}
      # Redpill AI provider
      REDPILL_API_KEY: ${REDPILL_API_KEY:-}
      # Encrypted S3 storage (optional — omit S3_BUCKET to use local volume)
      S3_BUCKET: ${S3_BUCKET:-}
      S3_PREFIX: ${S3_PREFIX:-openclaw-state}
      S3_ENDPOINT: ${S3_ENDPOINT:-}
      S3_REGION: ${S3_REGION:-us-east-1}
      S3_PROVIDER: ${S3_PROVIDER:-Other}
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID:-}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY:-}
      # Override derived crypt passwords (optional — only if not using MASTER_KEY)
      RCLONE_CRYPT_PASSWORD: ${RCLONE_CRYPT_PASSWORD:-}
      RCLONE_CRYPT_PASSWORD2: ${RCLONE_CRYPT_PASSWORD2:-}
    restart: unless-stopped

volumes:
  openclaw_state:
  docker_data:
